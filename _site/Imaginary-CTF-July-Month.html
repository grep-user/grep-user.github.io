<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Imaginary CTF July Month Writeup</title>

  <link rel="stylesheet" href="/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Imaginary CTF July Month Writeup | grep-user blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Imaginary CTF July Month Writeup" />
<meta name="author" content="grep-user" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Imaginary CTF organizes CTF every year, along with it they also create monthly challenges for users to play, featuring a leaderboard for each month." />
<meta property="og:description" content="Imaginary CTF organizes CTF every year, along with it they also create monthly challenges for users to play, featuring a leaderboard for each month." />
<link rel="canonical" href="http://localhost:8001/Imaginary-CTF-July-Month" />
<meta property="og:url" content="http://localhost:8001/Imaginary-CTF-July-Month" />
<meta property="og:site_name" content="grep-user blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-23T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Imaginary CTF July Month Writeup" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"grep-user","url":"https://grep-user.github.io"},"dateModified":"2024-06-23T00:00:00+05:30","datePublished":"2024-06-23T00:00:00+05:30","description":"Imaginary CTF organizes CTF every year, along with it they also create monthly challenges for users to play, featuring a leaderboard for each month.","headline":"Imaginary CTF July Month Writeup","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:8001/Imaginary-CTF-July-Month"},"url":"http://localhost:8001/Imaginary-CTF-July-Month"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1>grep-user@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/about"><h2 class="header-link">About</h2></a>
<a href="/atom.xml"><h2 class="header-link">RSS</h2></a>
    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>Imaginary CTF July Month Writeup</h2>
  <time datetime="2024-06-23T00:00:00+05:30" class="by-line">23 Jun 2024</time>
  <p>Imaginary CTF organizes CTF every year, along with it they also create monthly challenges for users to play, featuring a leaderboard for each month.</p>

<p>Whener I have some time, I use to play this challenges. So in this month they released few <a href="https://imaginaryctf.org/ArchivedChallenges/54">challenges</a></p>

<p>So this time I solved few challenges, so here are some solutions I come up with during challenge.</p>

<h3 id="functional-programming-reversing">Functional Programming [Reversing]</h3>

<p>This challenge contains output from the binary and C++ source file. So our goal in this challenge is to reverse the flag. Looking through C++ code we can see that the flag variable should have contained the real flag and it goes through some XORs and some binary options to convert the flag and prints it in hex format.</p>

<pre><code class="language-C++">char globalvar=0;

unsigned char flag[]="REDACTED";

unsigned char eor(unsigned char a)
{
	return a^0x007;
}

unsigned char inc(unsigned char a)
{
	flag[globalvar]=a;
	globalvar++;
	return flag[globalvar];
}

unsigned char rtr(unsigned char a)
{
	return (a &gt;&gt; 1) | (a &lt;&lt; (8-1) );
}


int main()
{
	
	inc(rtr(inc(eor(eor(inc(rtr(rtr(rtr(inc(eor(rtr(eor(inc(rtr(rtr(inc(eor(rtr(rtr(inc(eor(inc(rtr(rtr(rtr(inc(eor(eor(eor(inc(rtr(inc(eor(inc(rtr(rtr(rtr(inc(eor(eor(eor(rtr(inc(rtr(rtr(rtr(inc(eor(rtr(rtr(inc(eor(eor(eor(inc(rtr(rtr(rtr(eor(inc(eor(rtr(eor(rtr(inc(eor(rtr(eor(inc(rtr(inc(rtr(inc(eor(inc(eor(inc(rtr(eor(inc(rtr(inc(eor(inc(rtr(eor(flag[globalvar])))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))));
	for(int i=0;i&lt;27;i++)printf("%x ",flag[i]);
	printf("\n");
	return 0;
}
</code></pre>

<p>Inorder to solve this challenge I recreated the program in python. From the code it is clear each <code class="language-plaintext highlighter-rouge">inc</code> function call saves the encoded output of the char in the array and returns next char in the array to be encoded.</p>

<p>My first step was to convert the hex to decimal format.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FLAG</span> <span class="o">=</span> <span class="s">"18 6f 98 19 58 70 b0 9a 2b dc b 6a 4b a6 9c 2c 6c 99 58 2c 36 9f 8c 35 66 64 1a"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">flag_arr</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="s">'0x'</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">FLAG</span><span class="p">]</span>
</code></pre></div></div>

<p>The next step is to reverse the <code class="language-plaintext highlighter-rouge">eor</code> and <code class="language-plaintext highlighter-rouge">rtr</code> function. Since <code class="language-plaintext highlighter-rouge">eor</code> function just <strong>XORs</strong> the input, we can easily reverse it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reor</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">^</span><span class="mh">0x007</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> 
</code></pre></div></div>

<p>In my next step I converted the <strong>rtr</strong> function which returns <code class="language-plaintext highlighter-rouge">OR</code> of right shift of <strong>input</strong> to <code class="language-plaintext highlighter-rouge">1</code> and left shif to <strong>input</strong> to <code class="language-plaintext highlighter-rouge">7</code>.</p>

<p>In order to reverse I created a function which loops through <code class="language-plaintext highlighter-rouge">256</code> times[since each char is 8 bit long] and brute forced the output for the given input.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rrtr</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>  <span class="c1"># Possible values for an 8-bit number
</span>        <span class="k">if</span> <span class="p">(((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">==</span> <span class="n">a</span><span class="p">:</span>  <span class="c1"># Ensuring it fits within 16 bits
</span>            <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<p>Finally calling reverse functions for each iterations. I have’nt created reverse <code class="language-plaintext highlighter-rouge">inc</code> function, because I called reverse function for each character separatedly which gets my work done faster than writing its reverse.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">flag_arr</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="s">'0x'</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">FLAG</span><span class="p">]</span>
    
    <span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">8</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">9</span><span class="p">])))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">10</span><span class="p">])))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">11</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">12</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">13</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">14</span><span class="p">])))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">15</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">16</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">17</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">18</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">19</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">20</span><span class="p">]))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">21</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">22</span><span class="p">])))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">23</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">24</span><span class="p">]))))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">reor</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">25</span><span class="p">])))</span><span class="o">+</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">rrtr</span><span class="p">(</span><span class="n">flag_arr</span><span class="p">[</span><span class="mi">26</span><span class="p">])))</span>
</code></pre></div></div>

<p>Finally running the program prints the <strong>flag</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 sol.py
7h15_wa5_a_m157ak3_a1b2c3d4
</code></pre></div></div>

<h3 id="three-characters-web">Three Characters [Web]</h3>

<p>In this challenge, we are given a golang file which runs a http server which updates password for some time delay(looks like 10 seconds). The password is randomly chosen 32 characters from <code class="language-plaintext highlighter-rouge">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</code>. The goal of this challenge is to find correct password.</p>

<p>The server has 4 route handler. The <code class="language-plaintext highlighter-rouge">/source</code> and <code class="language-plaintext highlighter-rouge">/docker</code> are used to display the source and the dockerfile for the challenge. <code class="language-plaintext highlighter-rouge">/password</code> route reads password from form parameter, checks if it is equal to the password and returns the flag in response. So the goal of this challenge is to guess the 32 bytes random password which gets updated every 10 seconds.</p>

<p>But there is this one route <code class="language-plaintext highlighter-rouge">/characters</code> which looks suspicious. The <strong>charactersHandler</strong> will create 3 random integer within passwordLength and returns sha1 hash of characters in those indexes of password.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"crypto/sha1"</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"fmt"</span>
	<span class="s">"log"</span>
	<span class="s">"math/rand"</span>
	<span class="s">"net/http"</span>
	<span class="s">"os"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="c">//go:embed main.go</span>
<span class="k">var</span> <span class="n">source</span> <span class="p">[]</span><span class="kt">byte</span>

<span class="c">//go:embed Dockerfile</span>
<span class="k">var</span> <span class="n">docker</span> <span class="p">[]</span><span class="kt">byte</span>

<span class="k">var</span> <span class="n">password</span> <span class="kt">string</span>

<span class="k">var</span> <span class="n">passwordLength</span> <span class="o">=</span> <span class="m">32</span>
<span class="k">var</span> <span class="n">passwordNumber</span> <span class="o">=</span> <span class="m">0</span>

<span class="k">var</span> <span class="n">hashes</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="k">var</span> <span class="n">letters</span> <span class="o">=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="p">)</span>
<span class="k">var</span> <span class="n">keyPattern</span> <span class="o">=</span> <span class="s">"%d-%d-%d"</span>

<span class="k">var</span> <span class="n">globalVar</span> <span class="o">=</span> <span class="m">0</span>

<span class="k">type</span> <span class="n">charactersResponse</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Indices</span> <span class="p">[]</span><span class="kt">int</span>  <span class="s">`json:"indices"`</span>
	<span class="n">Hash</span>    <span class="kt">string</span> <span class="s">`json:"hash"`</span>
	<span class="n">Number</span>  <span class="kt">int</span>    <span class="s">`json:"number"`</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">randStringBytes</span><span class="p">(</span><span class="n">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>

	<span class="n">b</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">b</span> <span class="p">{</span>
		<span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">letters</span><span class="p">))]</span>
		<span class="n">globalVar</span> <span class="o">+=</span> <span class="m">1</span>
	<span class="p">}</span>
	
	<span class="k">return</span> <span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">updatePassword</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">password</span> <span class="o">=</span> <span class="n">randStringBytes</span><span class="p">(</span><span class="n">passwordLength</span><span class="p">)</span>
	<span class="n">tempHashes</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">passwordLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">passwordLength</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">{</span>
			<span class="k">for</span> <span class="n">k</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">passwordLength</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span> <span class="p">{</span>
				<span class="n">key</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="n">keyPattern</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
				<span class="n">hash</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%x"</span><span class="p">,</span> <span class="n">sha1</span><span class="o">.</span><span class="n">Sum</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="n">password</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">password</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">password</span><span class="p">[</span><span class="n">k</span><span class="p">]}))</span>

				<span class="n">tempHashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">hash</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">hashes</span> <span class="o">=</span> <span class="n">tempHashes</span>
	<span class="n">passwordNumber</span> <span class="o">+=</span> <span class="m">1</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">indexHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">http</span><span class="o">.</span><span class="n">ServeFile</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s">"index.html"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">sourceHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">dockerHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">docker</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">passwordHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">ParseForm</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
		<span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Failed to parse request"</span><span class="p">))</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">Form</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"password"</span><span class="p">)</span> <span class="o">==</span> <span class="n">password</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"Flag: %s"</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"FLAG"</span><span class="p">))</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusForbidden</span><span class="p">)</span>
	<span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Incorrect password"</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">charactersHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">indicies</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="n">passwordLength</span><span class="p">),</span> <span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="n">passwordLength</span><span class="p">),</span> <span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="n">passwordLength</span><span class="p">)}</span>
	
	<span class="n">globalVar</span> <span class="o">+=</span> <span class="m">1</span>
	<span class="n">globalVar</span> <span class="o">+=</span> <span class="m">1</span>
	<span class="n">globalVar</span> <span class="o">+=</span> <span class="m">1</span>

	<span class="n">hash</span> <span class="o">:=</span> <span class="n">hashes</span><span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="n">keyPattern</span><span class="p">,</span> <span class="n">indicies</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">indicies</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">indicies</span><span class="p">[</span><span class="m">2</span><span class="p">])]</span>
	<span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
	<span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">charactersResponse</span><span class="p">{</span><span class="n">Indices</span><span class="o">:</span> <span class="n">indicies</span><span class="p">,</span> <span class="n">Hash</span><span class="o">:</span> <span class="n">hash</span><span class="p">,</span> <span class="n">Number</span><span class="o">:</span> <span class="n">passwordNumber</span><span class="p">})</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">updatePassword</span><span class="p">()</span>

	<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Password is %s"</span><span class="p">,</span> <span class="n">keyPattern</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">indexHandler</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/source"</span><span class="p">,</span> <span class="n">sourceHandler</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/docker"</span><span class="p">,</span> <span class="n">dockerHandler</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/password"</span><span class="p">,</span> <span class="n">passwordHandler</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/characters"</span><span class="p">,</span> <span class="n">charactersHandler</span><span class="p">)</span>

	<span class="n">reset</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseDuration</span><span class="p">(</span><span class="s">"10s"</span><span class="p">)</span>
	<span class="n">ticker</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">NewTicker</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>

	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">for</span> <span class="k">range</span> <span class="n">ticker</span><span class="o">.</span><span class="n">C</span> <span class="p">{</span>
			<span class="n">updatePassword</span><span class="p">()</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":9000"</span><span class="p">,</span> <span class="no">nil</span><span class="p">))</span>
<span class="p">}</span>


</code></pre></div></div>

<p>Unfortunately, I wasn’t able to solve this during the challenge. However, later on with the help of the write-up from the challenge author, I was able to solve it. The write-up explains that…</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hash all the 3 letter combinations, keep making requests to /characters until you've seen every index
</code></pre></div></div>

<p>So my solution includes a loop which finds all the possible combination of characters <code class="language-plaintext highlighter-rouge">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</code> and finding its sha1 hash.</p>

<p>Later brute forcing indices using the <code class="language-plaintext highlighter-rouge">/characters</code> to find the hash from the dictionary which we have already created and mapping those characters with the index in our password. In order to find the hash within the short duration of 10 seconds I used concurrency.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha1</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">concurrent.futures</span>

<span class="n">letters</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>
<span class="n">letter_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>
<span class="n">hash_list</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">password</span> <span class="o">=</span> <span class="p">[</span><span class="s">''</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
<span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s">"https://three.ictf.iciaran.com/characters"</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">52</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">52</span><span class="p">):</span>
			<span class="n">chars</span> <span class="o">=</span> <span class="n">letter_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">letter_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">letter_arr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
			<span class="n">hash_list</span><span class="p">[</span><span class="n">sha1</span><span class="p">(</span><span class="n">chars</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">digest</span><span class="p">().</span><span class="nb">hex</span><span class="p">()]</span> <span class="o">=</span> <span class="n">chars</span>
   

<span class="k">def</span> <span class="nf">get_chars</span><span class="p">(</span><span class="nb">hash</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hash_list</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_chars</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">).</span><span class="n">json</span><span class="p">()</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'indices'</span><span class="p">)</span>
    
    <span class="n">hashed</span> <span class="o">=</span> <span class="n">get_chars</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
    <span class="n">password</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hashed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">password</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hashed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">password</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hashed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="k">while</span> <span class="s">''</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">find_chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
            <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
    
    <span class="n">password</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="n">req_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"password"</span><span class="p">:</span><span class="n">password</span><span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"https://three.ictf.iciaran.com/password"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">req_data</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

</code></pre></div></div>

<p>We won’t get the output if the password is updated midway while the script is running. However, by attempting it a few times, we should be able to find the flag.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 solve.py
Flag: ictf<span class="o">{</span>00ps_th1s_1s_jus7_l0ts_0f_thr33_l3tt3r_p4ssw0rds<span class="o">}</span>
</code></pre></div></div>


</article>
      </section>
    </div>
  </div>

   <footer>
  <a href="https://creativecommons.org/licenses/by-nc/3.0/deed.en_US">
    <span>
        <b>grep-user</b>
    </span>
    
    <span>© 2024</span>
  </a>
</footer>

  
</body>

</html>